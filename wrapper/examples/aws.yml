awk_fuse_parser: &awk_fuse_parser |
    awk '
    function output_fuse_dir(path) {
      return sprintf("ino=1 mode=drwxr-xr-x nlink=1 uid=0 gid=0 rdev=0 size=1024 blksize=512 blocks=2 atime=0 mtime=0 ctime=0 %s\0", $0) 
    }   
    {   
        printf("%s", output_fuse_dir($0)) 
    }'

aws_root: &aws_root
  cmd:
    - echo regions; echo zones

  parser:  
    - *awk_fuse_parser

# FIX me
# https://docs.aws.amazon.com/cli/latest/reference/configservice/list-discovered-resources.html
# https://github.com/JohannesEbke/aws_list_all
aws_resources: &aws_resources
  static:
    - ec2
    - eks
  

aws_regions: &aws_regions
  cmd:
    - aws ec2 describe-regions
  parser:  
    - jq -r '.Regions[].RegionName'
    - *awk_fuse_parser

aws_ec2_list: &aws_ec2_list
  cmd:
    - aws ec2 describe-instances
  parser:  
    - jq -r '.Reservations[].Instances[].InstanceId'
    - *awk_fuse_parser

aws_eks_list: &aws_eks_list
  cmd:
    - aws eks list-clusters
  parser:
    - jq -r '.clusters'
    - *awk_fuse_parser



wrapper_name: aws

fs:
  "/": # /aws
    "/regions": # /aws/regions
      # / aws/regions/us-west-1
      "/[a-z0-9-]+$":
        # /aws/regions/eu-central-1/ec2
        "/ec2$":
          readdir: *aws_ec2_list
        # /aws/regions/eu-central-1/eks
        "/eks$":
          readdir: *aws_eks_list
        readdir: *aws_resources
      readdir: *aws_regions
    readdir: *aws_root
      
    # /aws/resources
    "/resources":
      # /aws/resources/ec2
      "/ec2":
        readdir: *aws_ec2_list
      "/eks":
        readdir: *aws_eks_list
      readdir:
        readdir: *aws_resources
