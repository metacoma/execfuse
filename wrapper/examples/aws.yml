awk_fuse_parser: &awk_fuse_parser |
    awk '
    function output_fuse_dir(path) {
      return sprintf("ino=1 mode=drwxr-xr-x nlink=1 uid=0 gid=0 rdev=0 size=1024 blksize=512 blocks=2 atime=0 mtime=0 ctime=0 %s\0", $0) 
    }   
    BEGIN { 
        #printf("%s", output_fuse_dir(".")) 
        #printf("%s", output_fuse_dir("..")) 
    }
    {   
        printf("%s", output_fuse_dir($0)) 
    }'

aws_root: &aws_root
  cmd:
    - echo regions; echo resources
  parser:  
    - *awk_fuse_parser

# FIX me
# https://docs.aws.amazon.com/cli/latest/reference/configservice/list-discovered-resources.html
# https://github.com/JohannesEbke/aws_list_all
aws_resources: &aws_resources
  cmd:
    - |
      cat<<EOF
      ec2
      eks
      EOF
  parser:  
    - *awk_fuse_parser
  

aws_regions: &aws_regions
  cmd:
    - aws ec2 describe-regions
  parser:  
    - jq -r '.Regions[].RegionName'
    - *awk_fuse_parser

aws_ec2_list: &aws_ec2_list
  cmd:
    - aws ec2 describe-instances
  parser:  
    - jq -r '.Reservations[].Instances[].InstanceId'
    - *awk_fuse_parser

aws_eks_list: &aws_eks_list
  cmd:
    - aws eks list-clusters
  parser:
    - jq -r '.clusters'
    - *awk_fuse_parser



wrapper_name: aws

fs:
  "/": # /aws
    readdir: *aws_root
    "/regions": # /aws/regions
      readdir: *aws_regions
      "/[a-z0-9\\-]+": # / aws/regions/us-west-1
        readdir: *aws_resources
        "/ec2": # /aws/regions/eu-central-1/ec2
          readdir: *aws_ec2_list
        "/eks": # /aws/regions/eu-central-1/eks
          readdir: *aws_eks_list
      
    "/resources": # /aws/resources
      readdir: *aws_resources
      "/ec2": # /aws/resources/ec2
        readdir: *aws_ec2_list
      "/eks": # /aws/resources/eks
        readdir: *aws_eks_list
